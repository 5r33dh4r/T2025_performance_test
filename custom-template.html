<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üåê Custom Lighthouse Report</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  :root {
    --bg: #f6f7fb;
    --card: #ffffff;
    --text: #333;
    --primary: #4b8bf4;
    --accent: #4caf50;
  }

  body.dark {
    --bg: #121212;
    --card: #1e1e1e;
    --text: #e0e0e0;
    --primary: #82b1ff;
    --accent: #81c784;
  }

  body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    margin: 30px;
    background: var(--bg);
    color: var(--text);
    transition: all 0.3s ease;
  }

  .card {
    background: var(--card);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    max-width: 1000px;
    margin: auto;
    transition: all 0.3s ease;
  }

  h1 { color: var(--primary); margin-bottom: 10px; }
  .score { font-size: 48px; font-weight: bold; color: var(--accent); }
  .metric { margin-top: 10px; font-size: 18px; }
  canvas { margin-top: 30px; max-width: 100%; }
  table { width: 100%; border-collapse: collapse; margin-top: 30px; }
  th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
  th { background: #e9efff; color: var(--text); }
  body.dark th { background: #2b2b2b; }
  .btn-group { margin-top: 25px; }
  button {
    margin-right: 10px;
    background: var(--primary);
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s;
  }
  button:hover { background: #3a73d6; }
  .charts { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
  .chart-box {
    flex: 1 1 400px;
    background: var(--card);
    border-radius: 8px;
    padding: 10px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  }
  .theme-toggle {
    float: right;
    cursor: pointer;
    background: var(--primary);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    margin-top: -10px;
  }
</style>
</head>
<body>
  <div class="card">
    <button class="theme-toggle" onclick="toggleTheme()">üåô Toggle Dark Mode</button>
    <h1>Custom Lighthouse Report</h1>
    <p><strong>Page:</strong> http://127.0.0.1:8080/index.html</p>
    <p class="score">Performance Score: 49 / 100</p>
    <div class="metric">First Contentful Paint: 1617 ms</div>
    <div class="metric">Speed Index: 7671 ms</div>
    <div class="metric">Largest Contentful Paint: 1617 ms</div>
    <div class="metric">Cumulative Layout Shift: 0.243</div>
    <div class="metric">Total Blocking Time: 6972 ms</div>

    <div class="charts">
      <div class="chart-box">
        <canvas id="metricsChart"></canvas>
      </div>
      <div class="chart-box">
        <canvas id="pieChart"></canvas>
      </div>
    </div>

    <table id="metricsTable">
      <thead>
        <tr>
          <th>Metric</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>First Contentful Paint</td><td>1617 ms</td></tr>
        <tr><td>Speed Index</td><td>7671 ms</td></tr>
        <tr><td>Largest Contentful Paint</td><td>1617 ms</td></tr>
        <tr><td>Cumulative Layout Shift</td><td>0.243</td></tr>
        <tr><td>Total Blocking Time</td><td>6972 ms</td></tr>
      </tbody>
    </table>

    <div class="btn-group">
      <button onclick="downloadJSON()">üìÑ Download JSON</button>
      <button onclick="downloadCSV()">üìä Download CSV</button>
      <button onclick="downloadPDF()">üßæ Download PDF</button>
    </div>
  </div>

<script>
  const reportData = {
    url: "http://127.0.0.1:8080/index.html",
    score: 49,
    fcp: 1617,
    speedIndex: 7671,
    lcp: 1617,
    cls: 0.243,
    tbt: 6972
  };

  // --- Initialize Charts ---
  let barChart, pieChart;
  const chartColors = ['#4caf50', '#2196f3', '#ff9800', '#9c27b0', '#f44336'];
  const chartLabels = ['FCP', 'Speed Index', 'LCP', 'CLS', 'TBT'];
  const chartValues = [reportData.fcp, reportData.speedIndex, reportData.lcp, reportData.cls * 1000, reportData.tbt];

  function createCharts() {
    if (barChart) barChart.destroy();
    if (pieChart) pieChart.destroy();

    const textColor = document.body.classList.contains('dark') ? '#e0e0e0' : '#333';

    barChart = new Chart(document.getElementById('metricsChart'), {
      type: 'bar',
      data: {
        labels: chartLabels,
        datasets: [{
          label: 'Metric (ms)',
          data: chartValues,
          backgroundColor: chartColors
        }]
      },
      options: {
        plugins: {
          title: { display: true, text: 'Performance Metrics', color: textColor },
          legend: { labels: { color: textColor } }
        },
        scales: {
          x: { ticks: { color: textColor } },
          y: { beginAtZero: true, ticks: { color: textColor } }
        }
      }
    });

    pieChart = new Chart(document.getElementById('pieChart'), {
      type: 'doughnut',
      data: {
        labels: chartLabels,
        datasets: [{
          data: chartValues,
          backgroundColor: chartColors
        }]
      },
      options: {
        plugins: {
          title: { display: true, text: 'Metric Distribution', color: textColor },
          legend: { position: 'bottom', labels: { color: textColor } }
        }
      }
    });
  }

  createCharts();

  // --- Dark Mode Toggle ---
  function toggleTheme() {
    document.body.classList.toggle('dark');
    createCharts(); // Redraw with new theme colors
  }

  // --- Download JSON ---
  function downloadJSON() {
    const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'lighthouse-report.json';
    a.click();
  }

  // --- Download CSV ---
  function downloadCSV() {
    const rows = [
      ['Metric', 'Value'],
      ['First Contentful Paint', reportData.fcp + ' ms'],
      ['Speed Index', reportData.speedIndex + ' ms'],
      ['Largest Contentful Paint', reportData.lcp + ' ms'],
      ['Cumulative Layout Shift', reportData.cls],
      ['Total Blocking Time', reportData.tbt + ' ms'],
      ['Performance Score', reportData.score + '/100']
    ];
    const csv = rows.map(r => r.join(',')).join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'lighthouse-report.csv';
    a.click();
  }

  // --- Download PDF ---
  async function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(16);
    doc.text("Lighthouse Custom Report", 10, 20);
    doc.setFontSize(12);
    let y = 40;
    for (const [key, value] of Object.entries(reportData)) {
      doc.text(`${key.toUpperCase()}: ${value}`, 10, y);
      y += 10;
    }
    doc.save('lighthouse-report.pdf');
  }
</script>
</body>
</html>
