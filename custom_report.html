<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üåê Lighthouse Custom Report</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 30px; background: #f6f7fb; color: #333; }
  .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
  h1 { color: #4b8bf4; margin-bottom: 10px; }
  .score { font-size: 48px; font-weight: bold; color: #4caf50; }
  .metric { margin-top: 10px; font-size: 18px; }
  canvas { margin-top: 30px; }
  table { width: 100%; border-collapse: collapse; margin-top: 30px; }
  th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
  th { background: #e9efff; }
  .btn-group { margin-top: 25px; }
  button { margin-right: 10px; background: #4b8bf4; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; }
  button:hover { background: #3a73d6; }
</style>
</head>
<body>
  <div class="card">
    <h1>Custom Lighthouse Report</h1>
    <p><strong>Page:</strong> {{url}}</p>
    <p class="score">Performance Score: {{score}} / 100</p>
    <div class="metric">First Contentful Paint: {{fcp}} ms</div>
    <div class="metric">Speed Index: {{speedIndex}} ms</div>
    <div class="metric">Largest Contentful Paint: {{lcp}} ms</div>
    <div class="metric">Cumulative Layout Shift: {{cls}}</div>
    <div class="metric">Total Blocking Time: {{tbt}} ms</div>

    <canvas id="metricsChart" width="400" height="200"></canvas>

    <table id="metricsTable">
      <thead>
        <tr>
          <th>Metric</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>First Contentful Paint</td><td>{{fcp}} ms</td></tr>
        <tr><td>Speed Index</td><td>{{speedIndex}} ms</td></tr>
        <tr><td>Largest Contentful Paint</td><td>{{lcp}} ms</td></tr>
        <tr><td>Cumulative Layout Shift</td><td>{{cls}}</td></tr>
        <tr><td>Total Blocking Time</td><td>{{tbt}} ms</td></tr>
      </tbody>
    </table>

    <div class="btn-group">
      <button onclick="downloadJSON()">üìÑ Download JSON</button>
      <button onclick="downloadCSV()">üìä Download CSV</button>
      <button onclick="downloadPDF()">üßæ Download PDF</button>
    </div>
  </div>

<script>
  // Load data placeholders from template replacements
  const reportData = {
    url: "{{url}}",
    score: parseFloat("{{score}}"),
    fcp: parseFloat("{{fcp}}"),
    speedIndex: parseFloat("{{speedIndex}}"),
    lcp: parseFloat("{{lcp}}"),
    cls: parseFloat("{{cls}}"),
    tbt: parseFloat("{{tbt}}")
  };

  // Chart.js setup
  const ctx = document.getElementById('metricsChart');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['FCP', 'Speed Index', 'LCP', 'CLS', 'TBT'],
      datasets: [{
        label: 'Metric Values',
        data: [reportData.fcp, reportData.speedIndex, reportData.lcp, reportData.cls * 1000, reportData.tbt],
        backgroundColor: ['#4caf50', '#2196f3', '#ff9800', '#9c27b0', '#f44336']
      }]
    },
    options: {
      scales: {
        y: { beginAtZero: true, title: { display: true, text: 'Milliseconds (approx)' } }
      }
    }
  });

  // Download JSON
  function downloadJSON() {
    const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'lighthouse-report.json';
    a.click();
  }

  // Download CSV
  function downloadCSV() {
    const rows = [
      ['Metric','Value'],
      ['First Contentful Paint', reportData.fcp + ' ms'],
      ['Speed Index', reportData.speedIndex + ' ms'],
      ['Largest Contentful Paint', reportData.lcp + ' ms'],
      ['Cumulative Layout Shift', reportData.cls],
      ['Total Blocking Time', reportData.tbt + ' ms'],
      ['Performance Score', reportData.score + '/100']
    ];
    const csv = rows.map(r => r.join(',')).join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'lighthouse-report.csv';
    a.click();
  }

  // Download PDF
  async function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(16);
    doc.text("Lighthouse Custom Report", 10, 20);
    doc.setFontSize(12);
    let y = 40;
    for (const [key, value] of Object.entries(reportData)) {
      doc.text(`${key.toUpperCase()}: ${value}`, 10, y);
      y += 10;
    }
    doc.save('lighthouse-report.pdf');
  }
</script>
</body>
</html>

